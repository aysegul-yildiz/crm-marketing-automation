{% extends "base.html" %}
{% block content %}

<div style="max-width: 1000px; margin: 0 auto;">
    <h2>Campaign Workflows</h2>
    <hr />

    <div style="display: flex; gap: 25px;">

        <!-- ====================== LEFT COLUMN: CAMPAIGNS ====================== -->
        <div style="
            flex: 1;
            border: 1px solid #d1d5db;
            border-radius: 10px;
            padding: 15px;
        ">
            <h3 style="margin-top: 0;">Campaigns</h3>

            <ul style="padding-left: 0; list-style: none;">
                {% for c in campaigns %}
                <li style="margin-bottom: 10px; display:flex; justify-content:space-between;">

                    <label style="cursor:pointer;">
                        <strong>{{ c.name }}</strong>  
                        <span style="color:#6b7280;">(ID: {{ c.id }})</span>
                        <br>
                        <small>Status: {{ c.status }}</small>
                    </label>

                    <input type="radio"
                           name="campaign_select"
                           value="{{ c.id }}"
                           {% if selected_campaign_id == c.id %}checked{% endif %}
                           onchange="loadWorkflows(this.value)">
                </li>
                {% endfor %}
            </ul>
        </div>


        <!-- ====================== RIGHT COLUMN: WORKFLOWS ====================== -->
        <div style="
            flex: 1;
            border: 1px solid #d1d5db;
            border-radius: 10px;
            padding: 15px;
        ">
            <h3 style="margin-top: 0;">Workflows</h3>

            <!-- CONTAINER to dynamically update workflows -->
            <div id="workflow-box">

                {% if workflows %}
                <ul style="padding-left: 0; list-style: none;">

                    {% for w in workflows %}
                    <li style="
                        padding: 10px;
                        border: 1px solid #e5e7eb;
                        border-radius: 6px;
                        margin-bottom: 10px;
                    ">
                        <strong>{{ w.name }}</strong>
                        <br>
                        <small>ID: {{ w.id }}</small>
                    </li>
                    {% endfor %}

                </ul>

                {% else %}
                    <p style="color:#6b7280;">Select a campaign to view its workflows.</p>
                {% endif %}

            </div>

            <!-- Add Workflow Button -->
            {% if selected_campaign_id %}
            <form action="{{ url_for('campaigns.create_workflow') }}" method="POST" style="margin-top: 15px;">
                <input type="hidden" name="campaign_id" value="{{ selected_campaign_id }}">
                <input type="text" name="workflow_name" placeholder="New Workflow Name" required>
                <button type="submit" class="btn-pill btn-primary-pill" style="margin-top: 8px; width:100%;">
                    Add Workflow
                </button>
            </form>
            {% endif %}
        </div>

    </div>
</div>

<!-- ====================== AJAX SCRIPT ====================== -->
<script>
function loadWorkflows(campaignId) {
    fetch(`/campaigns/${campaignId}/workflows`)
        .then(response => response.text())
        .then(html => {
            document.getElementById("workflow-box").innerHTML = html;
        })
        .catch(err => console.error("Failed to load workflows:", err));
}
</script>

{% endblock %}
