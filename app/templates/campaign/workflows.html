{% extends "base.html" %}
{% block content %}

<div style="max-width: 1000px; margin: 0 auto;">
    <h2>Campaign Workflows</h2>
    <hr />

    <div style="display: flex; gap: 25px;">

        <!-- ====================== LEFT HALF ====================== -->
        <div style="flex: 1; display: flex; flex-direction: column; gap: 20px;">

            <!-- ========== CAMPAIGNS BOX ========== -->
            <div style="
                border: 1px solid #d1d5db;
                border-radius: 10px;
                padding: 15px;
            ">
                <h3 style="margin-top: 0;">Campaigns</h3>

                <ul style="padding-left: 0; list-style: none;">
                    {% for c in campaigns %}
                    <li style="margin-bottom: 10px; display:flex; justify-content:space-between;">

                        <!-- Replaced LABEL with DIV to stop auto form submission -->
                        <div style="cursor:pointer;">
                            <strong>{{ c.name }}</strong>
                            <span style="color:#6b7280;">(ID: {{ c.id }})</span>
                            <br>
                            <small>Status: {{ c.status }}</small>
                        </div>

                        <!-- onclick prevents redirects ALWAYS -->
                        <input type="radio"
                               name="campaign_select"
                               value="{{ c.id }}"
                               {% if selected_campaign_id == c.id %}checked{% endif %}
                               onclick="event.preventDefault(); loadWorkflows(this.value)">
                    </li>
                    {% endfor %}
                </ul>
            </div>


            <!-- ========== NEW WORKFLOW CREATION BOX ========== -->
            <div style="
                border: 1px solid #d1d5db;
                border-radius: 10px;
                padding: 15px;
            ">
                <h3 style="margin-top: 0;">Create Workflow</h3>

                {% if selected_campaign_id %}
                <form action="{{ url_for('campaigns.create_workflow') }}" method="POST">

                    <input type="hidden" name="campaign_id" value="{{ selected_campaign_id }}">

                    <label>Workflow Name:</label>
                    <input type="text"
                           name="workflow_name"
                           placeholder="Enter workflow name"
                           required
                           style="width: 100%; margin-top: 5px;">

                    <button type="submit"
                            class="btn-pill btn-primary-pill"
                            style="margin-top: 10px; width:100%;">
                        Add Workflow
                    </button>

                </form>
                {% else %}
                    <p style="color:#6b7280;">Select a campaign to create a workflow.</p>
                {% endif %}
            </div>

        </div>


        <!-- ====================== RIGHT HALF (unchanged) ====================== -->
        <div style="
            flex: 1;
            border: 1px solid #d1d5db;
            border-radius: 10px;
            padding: 15px;
        ">
            <h3 style="margin-top: 0;">Workflows</h3>

            <div id="workflow-box">
                {% if workflows %}
                <ul style="padding-left: 0; list-style: none;">
                    {% for w in workflows %}
                    <li style="
                        padding: 10px;
                        border: 1px solid #e5e7eb;
                        border-radius: 6px;
                        margin-bottom: 10px;
                    ">
                        <strong>{{ w.name }}</strong>
                        <br>
                        <small>ID: {{ w.id }}</small>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                    <p style="color:#6b7280;">Select a campaign to view its workflows.</p>
                {% endif %}
            </div>
        </div>

    </div>
</div>

<script>
function loadWorkflows(campaignId) {
    fetch(`/campaign/${campaignId}/workflows`)
        .then(response => response.text())
        .then(html => {
            document.getElementById("workflow-box").innerHTML = html;
        })
        .catch(err => console.error("Failed to load workflows:", err));
}
</script>

{% endblock %}
